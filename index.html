<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shark Pro - Earn & Withdraw</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #121212; color: white; padding: 20px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #333; }
        #balance { font-size: 2.5em; color: #4CAF50; margin: 10px 0; }
        button { background: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; width: 100%; margin: 10px 0; font-size: 1.1em; font-weight: bold; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #333; color: white; box-sizing: border-box; }
        .withdraw-section { display: none; background: #252525; padding: 15px; border-radius: 15px; border: 1px solid #444; }
    </style>
</head>
<body>

    <div class="card">
        <h2>የእርስዎ ሂሳብ</h2>
        <div id="balance">0.00 ETB</div>
        <button onclick="watchAd()">WATCH AD & EARN (0.50 ETB)</button>
        <button onclick="showWithdraw()" style="background: #2196F3;">CASH OUT (ብር አውጣ)</button>
    </div>

    <div id="withdraw-area" class="withdraw-section">
        <h3>ብር ማውጫ ፎርም</h3>
        <select id="bank-name">
            <option value="Telebirr">Telebirr (ቴሌብር)</option>
            <option value="CBE">CBE (ንግድ ባንክ)</option>
            <option value="Abyssinia">Abyssinia</option>
        </select>
        <input type="text" id="acc-number" placeholder="የአካውንት ወይም ስልክ ቁጥር">
        <input type="number" id="amount" placeholder="የሚወጣው መጠን">
        <button onclick="submitWithdraw()" style="background: #f44336;">ጥያቄ ላክ</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC6bxJ1d3GwzsSYAQM6YCNIxzHOcvQAHx4",
            authDomain: "shark-pro-fire.firebaseapp.com",
            databaseURL: "https://shark-pro-fire-default-rtdb.firebaseio.com",
            projectId: "shark-pro-fire",
            storageBucket: "shark-pro-fire.firebasestorage.app",
            messagingSenderId: "997842284367",
            appId: "1:997842284367:web:d862eb126a2cc711151f3a"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ተጠቃሚውን መለየት (በቴሌግራም ID ካልመጣ በራሱ ቁጥር ይሰጠዋል)
        const urlParams = new URLSearchParams(window.location.search);
        let userId = urlParams.get('user_id') || localStorage.getItem('local_user_id') || "user_" + Math.floor(Math.random() * 1000000);
        localStorage.setItem('local_user_id', userId);

        const userRef = database.ref('users/' + userId);

        // ባላንስን ከFirebase መጫን
        userRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && data.balance !== undefined) {
                document.getElementById('balance').innerText = data.balance.toFixed(2) + " ETB";
            }
        });

        // ብር ሲቆጠር ሴቭ ማድረግ
        function watchAd() {
            let current = parseFloat(document.getElementById('balance').innerText) || 0;
            userRef.update({ balance: current + 0.50 });
            alert("0.50 ETB ተጨምሯል!");
        }

        function showWithdraw() {
            document.getElementById('withdraw-area').style.display = 'block';
        }

        function submitWithdraw() {
            let amount = parseFloat(document.getElementById('amount').value);
            let current = parseFloat(document.getElementById('balance').innerText);
            let acc = document.getElementById('acc-number').value;

            if (!acc || !amount) {
                alert("እባክዎ መረጃውን ይሙሉ!");
                return;
            }
            if (amount > current) {
                alert("በቂ ባላንስ የሎትም!");
            } else {
                database.ref('withdrawals').push({
                    userId: userId,
                    bank: document.getElementById('bank-name').value,
                    account: acc,
                    amount: amount,
                    time: new Date().toLocaleString()
                });
                userRef.update({ balance: current - amount });
                alert("ጥያቄዎ ተልኳል!");
                document.getElementById('withdraw-area').style.display = 'none';
            }
        }
    </script>
</body>
</html>
